<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Summation Calculator + Explanation</title>
<style>
  :root{font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;--bg:#f7fafc;--card:#fff;--muted:#6b7280;}
  body{margin:0;background:var(--bg);color:#111;}
  .container{max-width:980px;margin:36px auto;padding:20px;}
  .card{background:var(--card);border-radius:12px;padding:20px;box-shadow:0 6px 18px rgba(16,24,40,0.06);}
  label{display:block;font-size:13px;margin:8px 0 4px;color:var(--muted);}
  input[type=text], input[type=number]{width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:8px;font-size:15px;}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;}
  button{background:#0ea5a4;color:white;padding:10px 14px;border-radius:10px;border:0;font-weight:600;cursor:pointer;}
  pre{background:#111827;color:#fff;padding:12px;border-radius:8px;overflow:auto;}
  table{width:100%;border-collapse:collapse;margin-top:12px;}
  th,td{padding:8px;border-bottom:1px solid #f3f4f6;text-align:right;}
  th{background:#f9fafb;text-align:left;}
  .muted{color:var(--muted);font-size:13px;}
  .row{display:flex;gap:8px;align-items:center;}
  .small{font-size:13px;}
  .tabs{display:flex;gap:12px;margin-bottom:12px;}
  .tab{padding:8px 16px;border-radius:8px;cursor:pointer;background:#e5e7eb;font-weight:600;}
  .tab.active{background:#0ea5a4;color:white;}
  .tab-content{display:none;}
  .tab-content.active{display:block;}
  .formula-big{font-size:26px;text-align:center;margin:12px 0;}
  .center{text-align:center;}
</style>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
<div class="container">
  <div class="tabs">
    <div class="tab active" onclick="showTab(0)">Calculator</div>
    <div class="tab" onclick="showTab(1)">How It Works</div>
  </div>

  <div class="tab-content active">
    <div class="card">
      <h2>Summation calculator</h2>
      <p class="muted">Evaluates \(\sum_{i=0}^{n-1}\big[ A(1+r_1)^i - B(1+r_2)^i\big](1+r_3)^{(n-1)-i}\). Here, A is total revenue, B is total expense.</p>

      <div class="grid" style="margin-top:12px">
        <div><label>A (total revenue)</label><input id="A" type="number" step="any" value="600"></div>
        <div><label>B (total expense)</label><input id="B" type="number" step="any" value="360"></div>
        <div><label>r1 (% revenue growth)</label><input id="r1" type="number" step="any" value="10"></div>
        <div><label>r2 (% expense growth)</label><input id="r2" type="number" step="any" value="8"></div>
        <div><label>r3 (% savings return)</label><input id="r3" type="number" step="any" value="12"></div>
        <div><label>n (years)</label><input id="nYears" type="number" step="1" value="20"></div>
        <div><label>Currency</label><input id="currency" type="text" value="‚Çπ"></div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
        <button id="go">Compute</button>
        <div class="small muted">Result (full precision): <code id="result">‚Äî</code></div>
        <div class="small muted">Rounded: <strong id="resultRounded">‚Äî</strong></div>
      </div>

      <div style="margin-top:14px">
        <div class="muted">LaTeX formula:</div>
        <pre id="latex"> </pre>
      </div>

      <div style="margin-top:12px">
        <label>WolframAlpha input (copy/paste):</label>
        <div style="display:flex;gap:8px"><input id="wa" type="text" style="flex:1"><button onclick="copyWA()">Copy</button></div>
      </div>

      <div style="margin-top:18px">
        <div class="muted">Terms:</div>
        <table>
          <thead><tr><th>i</th><th>term value</th></tr></thead>
          <tbody id="terms"></tbody>
        </table>
      </div>

      <div style="margin-top:16px;display:flex;gap:12px;flex-wrap:wrap">
        <a href="#" onclick="resetDefaults();return false;">Reset to your case</a>
        <a href="https://www.wolframalpha.com/" target="_blank">Open WolframAlpha</a>
      </div>
    </div>
  </div>

  <div class="tab-content">
    <div class="card">
      <h1>How the Summation Calculator Works</h1>
      <p class="center">This calculator evaluates the sum</p>
      <p class="formula-big">\(\displaystyle \sum_{i=0}^{n-1} \big[ A\,(1+r_1)^i - B\,(1+r_2)^i \big] (1+r_3)^{(n-1)-i} \)</p>

      <h2>Your explanation</h2>
      <div id="your-explanation" class="card" style="background:#f9fafb">The formula is a generalization to estimate the total return on net growing annuity for a given number of years. </div>

      <h2>Step-by-Step Explanation</h2>
      <ol>
        <li><strong>Totals:</strong> <code>A</code> is total revenue for year 0; <code>B</code> is total expense for year 0.</li>
        <li><strong>Rates (percent inputs):</strong> Enter <code>r1</code>, <code>r2</code>, <code>r3</code> as percentages. The formula uses <code>(1+r)</code> where internally we convert rates by dividing by 100.</li>
        <li><strong>Growth:</strong> Revenue grows by <code>(1+r1)^i</code>; expenses grow by <code>(1+r2)^i</code>.</li>
        <li><strong>Reinvestment/returns factor:</strong> Each year's net amount is scaled by <code>(1+r3)^{(n-1)-i}</code> to bring it to the end of year <code>n</code>.</li>
        <li><strong>Summation:</strong> We sum from <code>i=0</code> to <code>i=n-1</code>. The lower bound is fixed at 0.</li>
      </ol>

      <h2>Quick Tips</h2>
      <ul>
        <li>Use <code>n</code> as the number of years.</li>
        <li>Inputs for <code>r1</code>, <code>r2</code>, <code>r3</code> are in percent.</li>
        <li>You can copy the WolframAlpha input to verify the sum analytically.</li>
      </ul>


      <div class="muted" style="margin-top:12px">
        r1 is the rate at which revenue is expected to grow, r2 is the rate at which expenses are expected to grow (e.g., inflation), r3 is the rate of returns on savings, and n is the number of years (lowercase).
      </div>

      <p class="muted" style="margin-top:24px; text-align:center;">Shoutout to üçØ for the help with the math!</p>
    </div>
  </div>
</div>

<script>
  // Tab switching
  function showTab(index){
    document.querySelectorAll('.tab').forEach((t,i)=>t.classList.toggle('active',i===index));
    document.querySelectorAll('.tab-content').forEach((c,i)=>c.classList.toggle('active',i===index));
  }

  // Calculator functions
  function compute() {
    const A=parseFloat(document.getElementById('A').value);
    const B=parseFloat(document.getElementById('B').value);
    const r1Pct=parseFloat(document.getElementById('r1').value);
    const r2Pct=parseFloat(document.getElementById('r2').value);
    const r3Pct=parseFloat(document.getElementById('r3').value);
    const nYears=parseInt(document.getElementById('nYears').value,10);
    const currency=document.getElementById('currency').value || '';
    if([A,B,r1Pct,r2Pct,r3Pct,nYears].some(isNaN)){alert('Please enter valid numbers');return;}
    if(nYears<1){alert('n must be at least 1');return;}
    const r1=r1Pct/100, r2=r2Pct/100, r3=r3Pct/100;
    const i0=0;
    const iN=nYears-1;
    let total=0;
    const tbody=document.getElementById('terms'); tbody.innerHTML='';
    for(let i=i0;i<=iN;i++){
      const term=(A*Math.pow(1+r1,i)-B*Math.pow(1+r2,i))*Math.pow(1+r3,iN-i);
      total+=term;
      const tr=document.createElement('tr');
      tr.innerHTML=`<td style=\"text-align:left\">i=${i}</td><td>${currency} ${term.toFixed(2)}</td>`;
      tbody.appendChild(tr);
    }
    document.getElementById('result').textContent=total.toFixed(12);
    document.getElementById('resultRounded').textContent=`${currency} ${Number(total).toLocaleString(undefined,{maximumFractionDigits:2})}`;
    document.getElementById('latex').textContent=`\\sum_{i=${i0}}^{${iN}}\\left[ ${A}(1+${r1.toFixed(4)})^{i} - ${B}(1+${r2.toFixed(4)})^{i} \\right](1+${r3.toFixed(4)})^{${iN}-i}`;
    if(window.MathJax){MathJax.typesetPromise();}
    document.getElementById('wa').value=`sum[( ${A}*(1+(${r1Pct}/100))^i - ${B}*(1+(${r2Pct}/100))^i)*(1+(${r3Pct}/100))^(${iN}-i), i=${i0}..${iN}]`;
  }
  function copyWA(){const t=document.getElementById('wa');t.select();document.execCommand('copy');alert('Copied to clipboard');}
  function resetDefaults(){
    document.getElementById('A').value=600;
    document.getElementById('B').value=360;
    document.getElementById('r1').value=10;
    document.getElementById('r2').value=8;
    document.getElementById('r3').value=12;
    document.getElementById('nYears').value=20;
    document.getElementById('currency').value='‚Çπ';
    compute();
  }
  window.addEventListener('DOMContentLoaded',()=>{document.getElementById('go').addEventListener('click',compute);compute();});
</script>
</body>
</html>
